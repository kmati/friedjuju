!function e(n,t,r){function i(o,s){if(!t[o]){if(!n[o]){var d="function"==typeof require&&require;if(!s&&d)return d(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=t[o]={exports:{}};n[o][0].call(h.exports,function(e){var t=n[o][1][e];return i(t?t:e)},h,h.exports,e,n,t,r)}return t[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,n,t){function r(e,n,t,i){if(this.id=e,this.value=n,this.index=t,this.children=[],i)if(i instanceof Array)for(var a=0;a<i.length;a++)this.children.push(i[a]);else{if(!(i instanceof r))throw new Error("Invalid children passed into Token constructor. Token #"+this.id);this.children.push(i)}}r.prototype.addChild=function(e){if(!(e instanceof r))throw new Error("Invalid Token being added to Token #"+this.id+"\n-> childToken = "+e.toString());this.children.push(e)},r.Literal="Literal","undefined"!=typeof n&&(n.exports=r)},{}],2:[function(e,n,t){function r(e,n){e instanceof Array||(e=[e]),this.tokenIds=e,this.fnHandler=n}var i={subscriptions:[],getSubscriptionsForToken:function(e){var n=[];return this.subscriptions.forEach(function(t){t.tokenIds.indexOf(e.id)>-1&&n.push(t)}),n},emit:function(e,n){this.getSubscriptionsForToken(n).forEach(function(e){e.fnHandler(n)})}},a={traverse:function(e){var n=i.getSubscriptionsForToken(e);n.length>0&&i.emit(n,e);for(var t=0;t<e.children.length;t++){var r=e.children[t];this.traverse(r)}},subscribe:function(e,n){var t=new r(e,n);i.subscriptions.push(t)}};"undefined"!=typeof n&&(n.exports=a)},{}],3:[function(e,n,t){var r=e("./Token.js"),i=e("./parserUtilsRestricted.js"),a=e("./parserUtilsExtended.js");for(var o in a)r[o]=o;var s={parseExtended:function(e){var n=0,t=a.Expression(e,n);if(t.newIndex<e.length)throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(t.newIndex));return t},parseRestricted:function(e){var n=0,t=i.Expression(e,n);if(t.newIndex<e.length)throw new Error("Unparsed characters exist at the end of the expression: "+e.substr(t.newIndex));return t}};"undefined"!=typeof n&&(n.exports=s)},{"./Token.js":1,"./parserUtilsExtended.js":5,"./parserUtilsRestricted.js":6}],4:[function(e,n,t){var r=e("./Token.js"),i={checkMatch:function(e,n,t){return t>=e.length?void 0:e.substr(t,n.length)===n?{newIndex:t+n.length,token:new r(r.Literal,n,t)}:void 0},exactlyText:function(e,n,t,i){if(!(n>=e.length)){var a=this.checkMatch(e,t,n);if(a)return{newIndex:n+t.length,token:new r(i,e.substr(n,t.length),n)}}},repeat0Plus:function(e,n,t,i){if(!(n>=e.length)){for(var a=n,o=new r(r[t],"",n);n<e.length&&(ret=i[t](e,n),ret);)o.addChild(ret.token),n=ret.newIndex;if(!(o.children.length<1))return o.value=e.substring(a,n),{newIndex:n,token:o}}},repeat1Plus:function(e,n,t,i){if(!(n>=e.length)){var a=n,o=new r(r[t],"",n),s=i[t](e,n);if(s){for(o.addChild(s.token),n=s.newIndex;n<e.length&&(s=i[t](e,n));)o.addChild(s.token),n=s.newIndex;return o.value=e.substring(a,n),{newIndex:n,token:o}}}},onlyRepeat1Plus:function(e,n,t,i,a){if(!(n>=e.length)){var o=n,s=new r(a,"",n),d=this.repeat1Plus(e,n,t,i);return d&&(n=d.newIndex,s.addChild(d.token)),s.children.length>0?(s.value=e.substring(o,n),{newIndex:n,token:s}):void 0}},or:function(e,n,t,i,a){if(!(n>=e.length)){for(var o=n,s=void 0,d=-1,u=0;u<t.length;u++){var h=t[u],l=i[h](e,n);l&&d<l.newIndex&&(s=l.token,d=l.newIndex)}if(s){n=d;var c=new r(a,e.substring(o,n),n,s);return{newIndex:n,token:c}}}},exactlyOne:function(e,n,t,i,a){if(!(n>=e.length)){var o=n,s=new r(a,"",n),d=i[t](e,n);return d?(n=d.newIndex,s.addChild(d.token),s.value=e.substring(o,n),{newIndex:n,token:s}):void 0}},seq:function(e,n,t,i,a){if(!(n>=e.length)){for(var o=n,s=new r(a,"",n),d=0;d<t.length;d++){var u=t[d],h=i[u](e,n);if(!h)return;n=h.newIndex,s.addChild(h.token)}return s.children.length>0?(s.value=e.substring(o,n),{newIndex:n,token:s}):void 0}}};"undefined"!=typeof n&&(n.exports=i)},{"./Token.js":1}],5:[function(e,n,t){var r=e("./Token.js"),i=e("./parserCommonFunctions.js"),a=e("./parserUtilsRestricted.js"),o={ExpressionPiece:function(e,n){return i.or(e,n,["Wildcard","SingleObjectPlaceholder","NumberPrefixedElement","Attribute","Element","StringElement"],this,"ExpressionPiece")},Attribute:function(e,n){if(!(n>=e.length)){var t=n,a=i.checkMatch(e,"@",n);if(a){n=a.newIndex;var o=i.repeat1Plus(e,n,"Char",this);if(o)return n=o.newIndex,{newIndex:o.newIndex,token:new r(r.Attribute,e.substring(t,n),t,[a.token,o.token])}}}},BoundedAttributeExpression:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.BoundedAttributeExpression,"",n),o=i.checkMatch(e,"[",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.Attribute(e,n);if(s){n=s.newIndex,a.addChild(s.token);var d=i.checkMatch(e,"=",n);if(d){n=d.newIndex,a.addChild(d.token);var u=i.repeat1Plus(e,n,"Char",this);if(u){n=u.newIndex,a.addChild(u.token);var h=i.checkMatch(e,"]",n);if(h)return n=h.newIndex,a.addChild(h.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}}}}},BoundedAttributeDeclaration:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.BoundedAttributeDeclaration,"",n),o=i.checkMatch(e,"[",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.Attribute(e,n);if(s){n=s.newIndex,a.addChild(s.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,a.addChild(d.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}}},BoundedElementExpression:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.BoundedElementExpression,"",n),o=i.checkMatch(e,"[",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.ElementName(e,n);if(s){n=s.newIndex,a.addChild(s.token);var d=i.checkMatch(e,"=",n);if(d){n=d.newIndex,a.addChild(d.token);var u=i.repeat1Plus(e,n,"Char",this);if(u){n=u.newIndex,a.addChild(u.token);var h=i.checkMatch(e,"]",n);if(h)return n=h.newIndex,a.addChild(h.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}}}}},BoundedElementDeclaration:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.BoundedElementDeclaration,"",n),o=i.checkMatch(e,"[",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.ElementName(e,n);if(s){n=s.newIndex,a.addChild(s.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,a.addChild(d.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}}},ArrayIndex:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.ArrayIndex,"",n),o=i.checkMatch(e,"[",n);if(o){n=o.newIndex,a.addChild(o.token);var s=i.checkMatch(e,"*",n);if(s){n=s.newIndex,a.addChild(s.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,a.addChild(d.token),a.value=e.substring(t,n),{newIndex:n,token:a};return}var u=i.repeat1Plus(e,n,"Digit",this);if(u){n=u.newIndex,a.addChild(u.token);var d=i.checkMatch(e,"]",n);if(d)return n=d.newIndex,a.addChild(d.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}}},Element:function(e,n){if(!(n>=e.length)){var t=n,i=new r(r.Element,"",n),a=this.ElementName(e,n);if(a){n=a.newIndex,i.addChild(a.token);var o=this.ElementTail(e,n);return o&&(n=o.newIndex,i.addChild(o.token)),i.value=e.substring(t,n),{newIndex:n,token:i}}}},ElementName:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.ElementName,"",n),o=this.Char(e,n),s=this.Digit(e,n);if(!s&&o){var d=i.repeat1Plus(e,n,"Char",this);if(d)return n=d.newIndex,a.addChild(d.token),a.value=e.substring(t,n),{newIndex:n,token:a}}}},ElementTail:function(e,n){if(!(n>=e.length)){for(var t=n,i=new r(r.ElementTail,"",n);n<e.length;){var a=void 0,o=-1,s=this.BoundedAttributeExpression(e,n);s&&(a=s.token,o=s.newIndex);var d=this.BoundedAttributeDeclaration(e,n);d&&o<d.newIndex&&(a=d.token,o=d.newIndex);var u=this.BoundedElementExpression(e,n);u&&o<u.newIndex&&(a=u.token,o=u.newIndex);var h=this.BoundedElementDeclaration(e,n);h&&o<h.newIndex&&(a=h.token,o=h.newIndex);var l=this.ArrayIndex(e,n);if(l&&o<l.newIndex&&(a=l.token,o=l.newIndex),!a)break;n=o,i.addChild(a)}if(!(i.children.length<1))return i.value=e.substring(t,n),{newIndex:n,token:i}}},Char:function(e,n){if(!(n>=e.length)){var t=this.Dot(e,n);if(!t&&(t=this.Wildcard(e,n),!t&&(t=this.SingleObjectPlaceholder(e,n),!t))){var a=!0;if(["=","@","[","]"].forEach(function(r){t=i.checkMatch(e,r,n),t&&(a=!1)}),a)return{newIndex:n+1,token:new r(r.Char,e.substr(n,1),n)}}}},Wildcard:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.Wildcard,"",n),o=i.checkMatch(e,"*",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.ElementTail(e,n);return s&&(n=s.newIndex,a.addChild(s.token)),a.value=e.substring(t,n),{newIndex:n,token:a}}}},SingleObjectPlaceholder:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.SingleObjectPlaceholder,"",n),o=i.checkMatch(e,"?",n);if(o){n=o.newIndex,a.addChild(o.token);var s=this.ElementTail(e,n);return s&&(n=s.newIndex,a.addChild(s.token)),a.value=e.substring(t,n),{newIndex:n,token:a}}}}};for(var s in a)"ExpressionPiece"!==s&&"Attribute"!==s&&"Element"!==s&&"Wildcard"!==s&&"SingleObjectPlaceholder"!==s&&"Usage1Char"!==s&&(o[s]=a[s]);"undefined"!=typeof n&&(n.exports=o)},{"./Token.js":1,"./parserCommonFunctions.js":4,"./parserUtilsRestricted.js":6}],6:[function(e,n,t){var r=e("./Token.js"),i=e("./parserCommonFunctions.js"),a={Expression:function(e,n){if(!(n>=e.length)){var t=n,i=new r(r.Expression,"",n),a=this.ExpressionPiece(e,n);if(a){for(n=a.newIndex,i.addChild(a.token);n<e.length;){var o=n,s=[],d=this.Dot(e,n);if(!d)break;if(n=d.newIndex,s.push(d.token),a=this.ExpressionPiece(e,n),a&&(n=a.newIndex,s.push(a.token)),!s){n=o;break}for(var u=0;u<s.length;u++)i.addChild(s[u])}return i.children.length>0?(i.value=e.substring(t,n),{newIndex:n,token:i}):void 0}}},Dot:function(e,n){return i.exactlyText(e,n,".","Dot")},ExpressionPiece:function(e,n){return i.or(e,n,["NumberPrefixedElement","Attribute","Element","StringElement"],this,"ExpressionPiece")},Attribute:function(e,n){if(!(n>=e.length)){var t=n,a=i.checkMatch(e,"@",n);if(a){n=a.newIndex;var o=i.repeat1Plus(e,n,"Usage1Char",this);if(o)return n=o.newIndex,{newIndex:o.newIndex,token:new r(r.Attribute,e.substring(t,n),t,[a.token,o.token])}}}},Element:function(e,n){return i.onlyRepeat1Plus(e,n,"Usage1Char",this,"Element")},NumberPrefixedElement:function(e,n){if(!(n>=e.length)){var t=n,a=new r(r.NumberPrefixedElement,"",n),o=i.checkMatch(e,"$",n);if(o){a.addChild(o.token),n=o.newIndex;var s=i.repeat1Plus(e,n,"Digit",this);if(s){a.addChild(s.token),n=s.newIndex;var d=this.Element(e,n);if(d)return a.addChild(d.token),n=d.newIndex,a.value=e.substring(t,n),{newIndex:n,token:a}}}}},StringElement:function(e,n){return i.exactlyText(e,n,"$str","StringElement")},Digit:function(e,n){if(!(n>=e.length))for(var t=0;9>=t;t++){var a=i.checkMatch(e,t.toString(),n);if(a)return{newIndex:a.newIndex,token:new r(r.Digit,e.substr(n,1),n)}}},Usage1Char:function(e,n){if(!(n>=e.length)){var t=this.Dot(e,n);if(!t&&(t=this.Wildcard(e,n),!t&&(t=this.SingleObjectPlaceholder(e,n),!t))){var a=!0;if(["=","@","[","]"].forEach(function(r){t=i.checkMatch(e,r,n),t&&(a=!1)}),a)return{newIndex:n+1,token:new r(r.Usage1Char,e.substr(n,1),n)}}}},Wildcard:function(e,n){return i.exactlyText(e,n,"*","Wildcard")},SingleObjectPlaceholder:function(e,n){return i.exactlyText(e,n,"?","SingleObjectPlaceholder")}};"undefined"!=typeof n&&(n.exports=a)},{"./Token.js":1,"./parserCommonFunctions.js":4}],7:[function(e,n,t){function r(e,n){this.name=e,this.value=n}r.prototype.toString=function(){return" "+this.name+'="'+this.value+'"'},"undefined"!=typeof n&&(n.exports=r)},{}],8:[function(e,n,t){function r(e,n){this.tagName=e,this.attributes=[],this.children=[],"undefined"!=typeof n&&null!==n&&(n instanceof r?this.addChild(n):this.addChild(n.toString()))}var i=e("./Attr.js");r.prototype.addAttr=function(e){if(!(e instanceof i))throw new Error("Element.addAttr must be passed an instance of type: Attr");this.attributes.push(e)},r.prototype.getNumberedChildElementIndex=function(e,n){for(var t=-1,r=0;r<this.children.length;r++){var i=this.children[r];if(i.tagName===e&&(t++,t===n))return r}return-1},r.prototype.addChild=function(e,n){if(!(e instanceof r||e instanceof Array||"string"==typeof e))throw new Error("Element.addChild must be passed an Element instance, Array or a string");if("undefined"==typeof n)if(e instanceof Array)for(var t=0;t<e.length;t++)e[t].indexPos=n,this.children.push(e[t]);else this.children.push(e);else if(e instanceof Array)for(var t=e.length-1;t>=0;t--){e[t].indexPos=n;var i=this.getNumberedChildElementIndex(e[t].tagName,n);if(i>-1){var a=this.children[i].children,o=this.children[i].attributes;a.forEach(function(n){e[t].children.push(n)}),o.forEach(function(n){e[t].attributes.push(n)}),this.children[i]=e[t]}else this.children.push(e[t])}else{e.indexPos=n;var i=this.getNumberedChildElementIndex(e.tagName,n);if(i>-1){var a=this.children[i].children,o=this.children[i].attributes;a.forEach(function(n){e.children.push(n)}),o.forEach(function(n){e.attributes.push(n)}),this.children[i]=e}else this.children.push(e)}this.sortChildren()},r.prototype.sortChildren=function(){for(var e={},n=this.children.length-1;n>=0;n--){var t=this.children[n];if("number"==typeof t.indexPos){var r=e[t.tagName];r||(e[t.tagName]=r=[]),r.push({actualIndex:n,ele:t}),this.children[n]=null}}for(var i in e){var r=e[i];r.sort(function(e,n){return e.ele.indexPos-n.ele.indexPos});var a=[];r.forEach(function(e){a.push(e.actualIndex)}),a.sort();for(var o=0;o<a.length;o++){var t=r[o].ele,s=a[o];this.children[s]=t}}},r.prototype.toString=function(e){var n="number"==typeof e,t=void 0,i="";n&&(i="  ".repeat(e),t=e+1);var a=i+"<"+this.tagName;return this.attributes.forEach(function(e){a+=e.toString()}),a+=">",n&&this.children.length>0&&this.children[0]instanceof r&&(a+="\n"),this.children.forEach(function(e){a+=e.toString(t)}),n&&this.children.length>0&&this.children[0]instanceof r&&(a+=i),a+="</"+this.tagName+">",n&&(a+="\n"),a},"undefined"!=typeof n&&(n.exports=r)},{"./Attr.js":7}],9:[function(e,n,t){String.prototype.repeat=function(e){if(1>e)return"";for(var n="";e>0;)n+=this,e--;return n}},{}],10:[function(e,n,t){var r=e("./j2mTransformer.js"),i=e("./markupPrinter.js"),a=e("../vdom/domElementConverter.js"),o=e("../vdom");"undefined"==typeof window&&(window={});var s=window.j2m={domElementConverter:a,prettyPrint:!0,execute:function(e){var n=r.transform(e),t=this.prettyPrint?i.prettyPrint:i.print,a="";return n.children.forEach(function(e){a+=t.call(i,e)}),a},updateDOM:function(e,n){o.updateDOM(e,n)},updateDOMFromMarkupString:function(e,n){o.updateDOMFromMarkupString(e,n)},generateElement:function(e){return r.transform(e)},getMarkupFromElement:function(e){var n=this.prettyPrint?i.prettyPrint:i.print,t="";return"__ROOT__"===e.tagName?e.children.forEach(function(e){t+=n.call(i,e)}):t+=n.call(i,e),t}};"undefined"!=typeof n&&(n.exports=s)},{"../vdom":17,"../vdom/domElementConverter.js":15,"./j2mTransformer.js":11,"./markupPrinter.js":12}],11:[function(e,n,t){e("./String-Extensions.js");var r=e("./Attr.js"),i=e("./Element.js"),a=e("./objectGraphCreator"),o=e("../vdom/domElementConverter.js"),s=e("../vdom/strippedDownMarkupParser.js"),d={transform:function(e,n){if(n||(n=new i("__ROOT__")),"string"==typeof e)try{e=JSON.parse(e)}catch(t){var r=d.getStringAsMarkup(e);return n.addChild(r),n}else if("number"==typeof e||e instanceof Date||"boolean"==typeof e){var r=d.getStringAsMarkup(e.toString());return n.addChild(r),n}return d.transformObjectToMarkup(e,n),n},envelopeDOMElement:function(e){var n=new i("__ROOT__");if(e.innerHTML){var t=s.parse("<nop>"+o.convertDOMElementChildrenToXml(e)+"</nop>");t.children.forEach(function(e){n.addChild(e)})}return n},getStringAsMarkup:function(e){return e},transformObjectToMarkup:function(e,n){e instanceof Array&&e.forEach(function(e){d.transform(e,n)});var t=a.expand(e);for(var r in t){var i=t[r];if(r.indexOf(".")>-1)throw new Error("Found a dotted expression that was not expanded: "+r);if("@"===r[0]){var o=d.processAttr(r,i);n.addAttr(o)}else if("$str"===r)n.addChild(i);else if("$"===r[0]){var s=d.processNumberedElement(r,i);n.addChild(s.ele,s.index)}else{var u=d.processElement(r,i);n.addChild(u)}}},processAttr:function(e,n){return new r(e.substr(1),n.toString())},processElementWithPlainTextValue:function(e,n){return new i(e,n)},processNumberedElement:function(e,n){for(var t="",r=-1,i=1;i<e.length;i++)if(isNaN(e[i])){t=e.substr(i),r=parseInt(e.substr(1,i-1));break}if(""===t)throw new Error("Cannot resolve $ in property name: "+e);return{index:r,ele:this.processElement(t,n)}},processElement:function(e,n){if(n instanceof Array){var t=[];return n.forEach(function(n){var r=new i(e);d.transform(n,r),t.push(r)}),t}if("object"==typeof n){var r=new i(e);return d.transform(n,r),r}return d.processElementWithPlainTextValue(e,n)}};"undefined"!=typeof n&&(n.exports=d)},{"../vdom/domElementConverter.js":15,"../vdom/strippedDownMarkupParser.js":18,"./Attr.js":7,"./Element.js":8,"./String-Extensions.js":9,"./objectGraphCreator":13}],12:[function(e,n,t){var r={print:function(e){return e.toString()},prettyPrint:function(e){return e.toString(0)}};"undefined"!=typeof n&&(n.exports=r)},{}],13:[function(e,n,t){var r=e("../expression-parser/ep.js"),i=e("../expression-parser/astEmitter.js"),a={create:function(e,n,t){var a=r.parseExtended(e),o=void 0,s=void 0,d=void 0,u=void 0,h=[];return i.subscribe(["ExpressionPiece"],function(e){o||(o=n);var r=e.children[0];if("NumberPrefixedElement"===r.id)s=r.value;else if("Attribute"===r.id)s=r.value;else{if("Element"!==r.id){if("StringElement"===r.id)return void(o.$str=t);throw new Error("Invalid ExpressionPiece for object graph creation | token.id = "+e.id)}if(r.children.length>1){s=r.children[0].value;var i=r.children[1],a=i.children[0];if("ArrayIndex"!==a.id)throw new Error("You can only index arrays (ArrayIndex) and cannot use bounded element or attribute expressions for object graph creation | ai.id = "+a.id);u=Number(a.children[1].value)}else s=r.value,u=void 0}var l={};if(h.push(s),o[s])if("undefined"!=typeof u){var c=o[s];c instanceof Array||(c=[c]),l=c[u],l||(l=c[u]={})}else l=o[s];else"undefined"!=typeof u?(o[s]=[],o[s][u]=l):o[s]=l;d=o,o=l}),i.traverse(a.token),d&&s?("undefined"==typeof u?d[s]=t:d[s][u]=t,h):void 0},getPair:function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.keyToDelete===n)return r}}},o={expand:function(e){var n={},t=[];for(var r in e)if(n[r]=e[r],r.indexOf(".")>-1){var i=e[r],o=a.create(r,e,i);o&&t.push({keyToDelete:r,keyToAdd:o[0]})}var s={};for(var r in e){var d=a.getPair(t,r);d?"undefined"==typeof s[d.keyToAdd]&&(s[d.keyToAdd]="__placeholder__"):s[r]=e[r]}t.forEach(function(n){delete e[n.keyToAdd]});for(var r in n)e[r]=n[r];return s}};"undefined"!=typeof n&&(n.exports=o)},{"../expression-parser/astEmitter.js":2,"../expression-parser/ep.js":3}],14:[function(e,n,t){(function(e){}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./strippedDownMarkupParser.js":18}],15:[function(e,n,t){var r={convertDOMElementToXml:function(e){for(var n="<"+e.tagName,t=0;t<e.attributes.length;t++){var r=e.attributes[t];n+=" "+r.name+'="'+r.value+'"'}n+=">";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType){var a=this.convertDOMElementToXml(i);n+=a}else 3===i.nodeType&&(n+=i.textContent)}return n+="</"+e.tagName+">"},convertDOMElementChildrenToXml:function(e){for(var n="",t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];n+=this.convertDOMElementToXml(r)}return n},convertDOMElementToJSON:function(e){var n,t={};n=t[e.tagName]={};for(var r=0;r<e.attributes.length;r++){var i=e.attributes[r];n["@"+i.name]=i.value}for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType){var o=this.convertDOMElementToJSON(a)[a.tagName],s=n[a.tagName];s?(s instanceof Array||(n[a.tagName]=[s]),n[a.tagName].push(o)):n[a.tagName]=o}else 3===a.nodeType&&(n.$str=a.textContent)}return t},convertDOMElementChildrenToJSON:function(e){for(var n=[],t=0;t<e.childNodes.length;t++){var r=e.childNodes[t],i=this.convertDOMElementToJSON(r);n.push(i)}return n}};"undefined"!=typeof n&&(n.exports=r)},{}],16:[function(e,n,t){var r={setElementInnerHTML:function(e,n){"string"==typeof n?e.innerHTML=n:e.innerHTML=n.toString()},writePathsToElementOrAttr:function(e,n,t){e.forEach(function(e){if("@"===e[0])n.setAttribute(e.substr(1),t);else if("$str"===e)n.innerHTML=t;else{var i=Number(e);if(i<n.childNodes.length)n=n.childNodes[Number(e)];else{var a=document.createElement("nop");r.setElementInnerHTML(a,t);var o=a.childNodes[0];n.appendChild(o),n=o}}})},unwritePathsToElementOrAttr:function(e,n){var t,r;e.forEach(function(e){if("@"===e[0])n.removeAttribute(e.substr(1));else if("$str"===e)n.innerHTML="";else{r=n;var i=Number(e);if(!(i<n.childNodes.length))throw new Error("Cannot delete DOM element or attribute. No child found at index: "+i);n=n.childNodes[Number(e)],t=n}}),r&&r.removeChild(t)}},i={dottifyPathExpression:function(e){var n=e.replace("__ROOT__","").replace(/\[/g,".").replace(/\]/g,""),t=n.split(".");return t.length>0&&""===t[0]?t.slice(1):t},add:function(e,n){this.set(e,n)},"delete":function(e,n){if(e.pathToAttr){var t=this.dottifyPathExpression(e.pathToAttr);r.unwritePathsToElementOrAttr(t,n)}else if(e.pathToEle){var t=this.dottifyPathExpression(e.pathToEle);r.unwritePathsToElementOrAttr(t,n)}},set:function(e,n){if(e.pathToAttr){var t=this.dottifyPathExpression(e.pathToAttr);r.writePathsToElementOrAttr(t,n,e.attr)}else if(e.pathToEle){var t=this.dottifyPathExpression(e.pathToEle);r.writePathsToElementOrAttr(t,n,e.ele)}}},a={writeDiffsToDOMElement:function(e,n){e.forEach(function(e){if("add"!==e.changeType&&"delete"!==e.changeType&&"set"!==e.changeType)throw new Error("Found an invalid changeType: "+e.changeType+" | diff = "+JSON.stringify(e,void 0,2));i[e.changeType](e,n)})}};"undefined"!=typeof n&&(n.exports=a)},{"./document-shim.js":14}],17:[function(e,n,t){function r(e,n,t){var r=i.diff(e,n);a.writeDiffsToDOMElement(r,t)}var i=e("./treeDiff.js"),a=e("./domWriter.js"),o=e("../json-to-markup/j2mTransformer.js"),s=e("./strippedDownMarkupParser.js"),d={updateDOM:function(e,n){var t=o.envelopeDOMElement(n),i=o.transform(e);r(t,i,n)},updateDOMFromMarkupString:function(e,n){var t=o.envelopeDOMElement(n),i=s.parse("<__ROOT__>"+e+"</__ROOT__>");r(t,i,n)}};"undefined"!=typeof n&&(n.exports=d)},{"../json-to-markup/j2mTransformer.js":11,"./domWriter.js":16,"./strippedDownMarkupParser.js":18,"./treeDiff.js":19}],18:[function(e,n,t){var r=e("../expression-parser/astEmitter.js"),i=e("../expression-parser/Token.js"),a=e("../expression-parser/parserCommonFunctions.js"),o=e("../json-to-markup/Attr.js"),s=e("../json-to-markup/Element.js"),d={Element:function(e,n){if(!(n>=e.length)){var t=n,r=new i(i.Element,"",n),a=this.Whitespaces(e,n);a&&(n=a.newIndex,r.addChild(a.token));var o=this.OpenTagStart(e,n);if(o){n=o.newIndex,r.addChild(o.token);var s=this.AttributeDeclarations(e,n);s&&(n=s.newIndex,r.addChild(s.token));var d=this.ShortCloseTag(e,n);if(d)return n=d.newIndex,r.addChild(d.token),a=this.Whitespaces(e,n),a&&(n=a.newIndex,r.addChild(a.token)),r.value=e.substring(t,n),{newIndex:n,token:r};var u=this.OpenTagStop(e,n);if(u){n=u.newIndex,r.addChild(u.token);var h=this.Children(e,n);h&&(n=h.newIndex,r.addChild(h.token));var l=this.CloseTag(e,n);if(l)return n=l.newIndex,r.addChild(l.token),a=this.Whitespaces(e,n),a&&(n=a.newIndex,r.addChild(a.token)),r.value=e.substring(t,n),{newIndex:n,token:r}}}}},Children:function(e,n){return a.onlyRepeat1Plus(e,n,"ElementChildNode",this,"Children")},ElementChildNode:function(e,n){return a.or(e,n,["Element","ElementTextValue"],this,"ElementChildNode")},ElementTextValue:function(e,n){return a.exactlyOne(e,n,"SpaceyChars",this,"ElementTextValue")},OpenTagStart:function(e,n){if(!(n>=e.length)){var t=n,r=new i(i.OpenTagStart,"",n),o=a.checkMatch(e,"<",n);if(o){n=o.newIndex,r.addChild(o.token);var s=this.TagName(e,n);if(s)return n=s.newIndex,r.addChild(s.token),r.value=e.substring(t,n),{newIndex:n,token:r}}}},OpenTagStop:function(e,n){return a.exactlyText(e,n,">","OpenTagStop")},CloseTag:function(e,n){if(!(n>=e.length)){var t=n,r=new i(i.CloseTag,"",n),o=a.checkMatch(e,"</",n);if(o){n=o.newIndex,r.addChild(o.token);var s=this.TagName(e,n);if(s){n=s.newIndex,r.addChild(s.token);var d=a.checkMatch(e,">",n);if(d)return n=d.newIndex,r.addChild(d.token),r.value=e.substring(t,n),{newIndex:n,token:r}}}}},ShortCloseTag:function(e,n){return a.exactlyText(e,n,"/>","ShortCloseTag")},TagName:function(e,n){return a.exactlyOne(e,n,"Chars",this,"TagName")},AttributeDeclarations:function(e,n){function t(){var t=o.Whitespaces(e,n);if(t){n=t.newIndex,a.addChild(t.token);var r=o.AttributeDeclaration(e,n);if(r)return n=r.newIndex,a.addChild(r.token),!0}return!1}if(!(n>=e.length)){var r=n,a=new i(i.AttributeDeclarations,"",n),o=this;if(t()){for(;n<e.length&&t(););return a.children.length>0?(a.value=e.substring(r,n),{newIndex:n,token:a}):void 0}}},AttributeDeclaration:function(e,n){return n>=e.length?void 0:a.seq(e,n,["AttributeName","Eq","AttributeValue"],this,"AttributeDeclaration")},AttributeName:function(e,n){return a.exactlyOne(e,n,"Chars",this,"AttributeName")},Eq:function(e,n){return a.exactlyText(e,n,"=","Eq")},Quote:function(e,n){return a.exactlyText(e,n,'"',"Quote")},AttributeValue:function(e,n){return a.seq(e,n,["Quote","AttributeValueString","Quote"],this,"AttributeValue")},AttributeValueString:function(e,n){return a.exactlyOne(e,n,"SpaceyChars",this,"AttributeValueString")},Whitespaces:function(e,n){return a.onlyRepeat1Plus(e,n,"Whitespace",this,"Whitespaces")},Whitespace:function(e,n){if(!(n>=e.length)){var t=!1;return[" ","\r","\n","	"].forEach(function(r){var i=a.checkMatch(e,r,n);return i?void(t=!0):void 0}),t?{newIndex:n+1,token:new i(i.Whitespace,e.substr(n,1),n)}:void 0}},Chars:function(e,n){return a.onlyRepeat1Plus(e,n,"Char",this,"Chars")},Char:function(e,n){if(!(n>=e.length)){var t=this.Whitespace(e,n);if(!t&&(t=this.SpaceyChar(e,n)))return{newIndex:n+1,token:new i(i.Char,e.substr(n,1),n)}}},SpaceyChars:function(e,n){return a.onlyRepeat1Plus(e,n,"SpaceyChar",this,"SpaceyChars")},SpaceyChar:function(e,n){if(!(n>=e.length)){var t=this.Eq(e,n);if(!t&&(t=this.Quote(e,n),!t)){var r=!0;return["'","[","]","(",")","<",">","/"].forEach(function(t){var i=a.checkMatch(e,t,n);return i?void(r=!1):void 0}),r?{newIndex:n+1,token:new i(i.SpaceyChar,e.substr(n,1),n)}:void 0}}}};for(var u in d)i[u]=u;var h={render:function(e){var n,t=[];return r.subscribe(["OpenTagStart"],function(e){var r=e.children[1].value,i=new s(r);n||(n=i);var a;t.length>0&&(a=t[t.length-1],a.addChild(i)),t.push(i)}),r.subscribe(["AttributeDeclaration"],function(e){var n=e.children[0].value,r=e.children[2].children[1].value,i=t[t.length-1];i.addAttr(new o(n,r))}),r.subscribe(["ElementTextValue"],function(e){var n=e.value,r=t[t.length-1];r.addChild(n)}),r.subscribe(["ShortCloseTag","CloseTag"],function(e){t.pop()}),r.traverse(e.token),n}},l={parse:function(e){var n=0,t=d.Element(e,n);if(t.newIndex<e.length)throw new Error("Unparsed characters exist at the end of the markup string: "+e.substr(t.newIndex));var r=h.render(t);return r}};"undefined"!=typeof n&&(n.exports=l)},{"../expression-parser/Token.js":1,"../expression-parser/astEmitter.js":2,"../expression-parser/parserCommonFunctions.js":4,"../json-to-markup/Attr.js":7,"../json-to-markup/Element.js":8}],19:[function(e,n,t){function r(){}function i(e,n,t){this.pathToEle=e,this.changeType=n,this.ele=t}function a(e,n,t){this.pathToEle=e,this.changeType=n,this.tagName=t}function o(e,n,t){this.pathToAttr=e,this.changeType=n,this.attr=t}var s=e("../json-to-markup/Element");i.prototype=new r,a.prototype=new r,o.prototype=new r;var d={getAttributeByName:function(e,n){for(var t=0;t<e.attributes.length;t++){var r=e.attributes[t];if(r.name.toLowerCase()===n.toLowerCase())return r}},compareElement:function(e,n,t,r){if(n===r)return[];var u=[];if(n.tagName.toLowerCase()!==r.tagName.toLowerCase()){var h=new a(e,"set",r.tagName);u.push(h)}var l=[];n.attributes.forEach(function(n){var t=d.getAttributeByName(r,n.name);if(t){if(n.value!==t.value){var i=new o(e+".@"+n.name,"set",t.value);u.push(i)}}else{var i=new o(e+".@"+n.name,"delete",null);u.push(i)}l.push(t)}),r.attributes.forEach(function(n){if(-1===l.indexOf(n)){var t=new o(e+".@"+n.name,"add",n.value);u.push(t)}});for(var c=0,f=0;c<n.children.length&&f<r.children.length;){var p=n.children[c],v=r.children[f],m=!0;if("string"==typeof p&&"string"==typeof v){if(p!==v){var h=new i(e+".$str","set",v);u.push(h),m=!1}}else"string"==typeof p&&v instanceof s?(u.push(new i(e+".$str","delete",null)),u.push(new i(e+"["+c+"]","add",v)),m=!1):p instanceof s&&"string"==typeof v&&(u.push(new i(e+"["+c+"]","delete",null)),u.push(new i(e+".$str","add",v)),m=!1);if(m){var x=this.compareElement(e+"["+c+"]",p,t+"["+f+"]",v);x.forEach(function(e){u.push(e)})}c++,f++}if(c>=n.children.length)for(;f<r.children.length;)u.push(new i(e+"["+f+"]","add",r.children[f])),f++;else for(;c<n.children.length;)u.push(new i(e+"["+c+"]","delete",null)),c++;return u}},u={diff:function(e,n){var t=d.compareElement(e.tagName,e,n.tagName,n);return t}};"undefined"!=typeof n&&(n.exports=u)},{"../json-to-markup/Element":8}]},{},[10]),"undefined"!=typeof module&&(module.exports=window.j2m);